# 需求文档

## 简介

Agent Scanner MVP 是 Agent Signals 平台的核心功能重构，将传统的"填表式发布"转变为"诊断优化式发布"。用户只需输入一个 URL（GitHub 仓库或 SaaS 官网），系统自动扫描并计算 Signal Rank (SR) 评分，展示优化建议，引导开发者认领并优化其 Agent 的 AI 可见性。

本功能包含三大核心板块：
1. **The Scanner** - URL 扫描诊断页
2. **The Index** - SR 排序的搜索结果列表
3. **The Connector** - 一键复制 Interface Prompt

## 术语表

- **Signal Rank (SR)**: Agent 在 AI 经济体中的可见性和可连接性评分，范围 0.0-10.0
- **Track A**: 针对 GitHub 开源项目的评分轨道
- **Track B**: 针对 SaaS/商业产品的评分轨道
- **Hybrid（混合型）**: 同时拥有 GitHub 仓库和独立官网的混合型项目
- **MCP (Model Context Protocol)**: AI Agent 互操作协议标准
- **JSON-LD**: 结构化数据标记格式，用于提升 AI 可见性
- **AEO (AI Engine Optimization)**: AI 时代的 SEO，优化 Agent 被 AI 发现的能力
- **Claimed/Verified（已认领/已验证）**: 开发者已认领并验证所有权的 Agent 状态
- **Interface Prompt（接口提示词）**: 用于让 LLM 调用 Agent API 的系统提示词模板
- **AI-Ready Badge（AI就绪徽章）**: 可嵌入的 SVG 徽章，展示 Agent 的 SR 等级并链接回报告页

## 需求列表

### 需求 1: URL 扫描输入

**用户故事:** 作为开发者，我希望只输入一个 URL 就能扫描我的 Agent，这样我可以快速看到 SR 评分，而不用填写冗长的表单。

#### 验收标准

1. 当用户在扫描输入框中输入 URL 时，扫描系统应在启动扫描前验证 URL 格式
2. 当提交有效 URL 时，扫描系统应检测该 URL 是 GitHub 仓库还是 SaaS 网站
3. 当 URL 检测完成时，扫描系统应将扫描路由到相应的评分轨道（GitHub 走 Track A，SaaS 走 Track B）
4. 当扫描启动时，扫描系统应显示带有进度指示的加载状态
5. 如果提交了无效 URL，扫描系统应显示清晰的错误消息，说明预期的格式

### 需求 2: Signal Rank 计算 - Track A (GitHub)

**用户故事:** 作为开源开发者，我希望我的 GitHub 项目能基于社区信任度和机器就绪度获得公平评分，这样我的高星项目能得到应有的认可。

#### 验收标准

1. 当扫描 GitHub 仓库时，SR 计算器应提取星标数量并计算社区信任分数（最高 2.0 分，基于星标阶梯：>20k=2.0, >10k=1.5, >5k=1.0, >1k=0.5）
2. 当扫描 GitHub 仓库时，SR 计算器应检查 Fork 比率，如果 Fork 数超过星标数的 10%，则奖励最高 1.0 分
3. 当扫描 GitHub 仓库时，SR 计算器应检查最后提交日期，如果在 30 天内则奖励 1.0 分
4. 当扫描 GitHub 仓库时，SR 计算器应检测 openapi.json、swagger.yaml 或 manifest.json 的存在，并奖励 1.5 分
5. 当扫描 GitHub 仓库时，SR 计算器应检测 MCP 相关关键词，如果支持 MCP 则奖励 2.0 分
6. 当扫描 GitHub 仓库时，SR 计算器应检测 Dockerfile 的存在，并奖励 0.5 分
7. 当扫描 GitHub 仓库时，SR 计算器应评估 README 长度，如果超过 200 行且包含 Usage 代码块则奖励 1.0 分
8. 当扫描 GitHub 仓库时，SR 计算器应使用关键词匹配从 README 中提取输入/输出模态（Text、Image、Audio、JSON、Code、File）
9. 当 GitHub 仓库包含 homepage 字段时，SR 计算器应自动触发该 URL 的 Track B 扫描以启用混合评分

### 需求 3: Signal Rank 计算 - Track B (SaaS)

**用户故事:** 作为 SaaS 产品所有者，我希望我的商业产品能基于 AI 可见性和互操作性获得评分，这样我可以在没有开源指标的情况下公平竞争。

#### 验收标准

1. 当扫描 SaaS 网站时，SR 计算器应验证 HTTPS 和 SSL 证书有效性，有效证书奖励 1.0 分
2. 当扫描 SaaS 网站时，SR 计算器应检测社交链接（Twitter、GitHub、Discord、LinkedIn），如果至少有 2 个则奖励 1.0 分
3. 当扫描 SaaS 网站时，SR 计算器应检查 JSON-LD 结构化数据，如果存在则奖励 2.0 分
4. 当扫描 SaaS 网站时，SR 计算器应验证基础 Meta 标签（Title、Description、H1），如果完整则奖励 1.0 分
5. 当扫描 SaaS 网站时，SR 计算器应检测 Open Graph 标签，如果 og:image 和 og:title 都存在则奖励 1.0 分
6. 当扫描 SaaS 网站时，SR 计算器应扫描 API 文档路径（/docs、/api、/developers），如果找到则奖励 1.5 分
7. 当扫描 SaaS 网站时，SR 计算器应检测集成关键词（SDK、Webhook、Zapier、Plugin），如果提及则奖励 1.0 分
8. 当扫描 SaaS 网站时，SR 计算器应使用关键词匹配从 Meta 描述和页面内容中提取输入/输出模态（Text、Image、Audio、JSON、Code、File）

### 需求 4: 混合评分与最终计算

**用户故事:** 作为同时拥有 GitHub 仓库和 SaaS 网站的开发者，我希望因为同时维护两者而获得额外加分，这样我的全面方法能得到奖励。

#### 验收标准

1. 当 Agent 同时拥有 GitHub 仓库和主页 URL 时，SR 计算器应计算两个轨道的分数
2. 当计算混合分数时，SR 计算器应使用公式：最终 SR = Max(Score_A, Score_B) + 0.5（混合奖励）
3. 当最终分数超过 10.0 时，SR 计算器应将分数封顶为 10.0
4. 当分数计算完成时，SR 计算器应将最终分数四舍五入到一位小数
5. 当分数计算完成时，SR 计算器应确定等级徽章（S: 9.0-10.0, A: 7.5-8.9, B: 5.0-7.4, C: <5.0）

### 需求 5: 扫描结果展示

**用户故事:** 作为开发者，我希望在扫描后看到清晰的诊断报告，这样我能准确了解需要改进什么。

#### 验收标准

1. 当扫描完成时，结果展示应醒目地显示最终 SR 分数和等级徽章
2. 当扫描完成时，结果展示应显示关键指标的红/绿状态指示器（JSON-LD、MCP、Stars、Meta 标签）
3. 当扫描完成时，结果展示应显示检测到的轨道类型（OpenSource、SaaS 或 Hybrid）
4. 当某个指标失败时，结果展示应为该指标提供可操作的改进建议
5. 当扫描完成时，结果展示应为未认领的 Agent 显示"认领并优化"按钮

### 需求 6: JSON-LD 和徽章生成器

**用户故事:** 作为开发者，我希望系统为我的 Agent 生成 JSON-LD 代码和可嵌入的徽章，这样我可以提升 AI 可见性评分并为报告页引流。

#### 验收标准

1. 当用户点击"认领并优化"时，JSON-LD 生成器应基于扫描信息创建结构化数据标记
2. 当生成 JSON-LD 时，生成器应包含 @type、name、description、url 和 provider 字段
3. 当生成 JSON-LD 时，生成器应将输出格式化为可复制的代码块
4. 当用户复制 JSON-LD 时，生成器应提供部署说明
5. 当 JSON-LD 生成后，生成器应包含"验证部署"按钮用于重新扫描
6. 当 JSON-LD 生成后，徽章生成器应同时提供"AI-Ready 徽章"的 HTML 嵌入代码（链接回 Agent 报告页的 SVG 图片）
7. 当生成徽章时，徽章生成器应使用等级特定的颜色（S 级绿色、A 级蓝色、B 级黄色、C 级灰色）
8. 当徽章嵌入代码被复制时，生成器应跟踪嵌入事件用于反链分析

### 需求 7: Agent 索引展示

**用户故事:** 作为用户，我希望浏览按 SR 分数排序的终端风格 Agent 列表，这样我可以快速找到可靠的工具。

#### 验收标准

1. 当展示 Agent 索引时，索引展示应按 Signal Rank 分数降序排列 Agent
2. 当展示每个 Agent 行时，索引展示应显示名称、SR 分数、MCP 标签（如适用）和输入/输出类型
3. 当展示 Agent 行时，索引展示应使用与 show-agentv3.0.html 参考一致的终端风格视觉设计
4. 当用户切换"仅显示已验证"过滤器时，索引展示应只显示已认领/已验证状态的 Agent
5. 当鼠标悬停在 Agent 行上时，索引展示应显示操作按钮（复制 JSON-LD、查看文档）

### 需求 8: Interface Prompt 连接器

**用户故事:** 作为用户，我希望复制一个即用型提示词来将 Agent 连接到 ChatGPT，这样我可以立即开始使用该工具。

#### 验收标准

1. 当用户点击"连接"按钮时，连接器应基于 Agent 元数据生成 Interface Prompt
2. 当生成 Interface Prompt 时，连接器应包含 Agent 名称、API 端点和能力描述
3. 当 Agent 需要 API 密钥时，连接器应在提示词中包含占位符文本"<PASTE_YOUR_KEY_HERE>"
4. 当用户点击复制时，连接器应将提示词复制到剪贴板并显示成功反馈
5. 当提示词被复制时，连接器应跟踪复制事件用于分析
6. 当 Track B Agent 没有可用的 API 结构时，连接器应生成描述 Agent 能力的自然语言系统提示词，而不是空的 payload

### 需求 9: 数据持久化

**用户故事:** 作为平台运营者，我希望扫描结果持久化到数据库，这样 Agent 索引保持填充状态，分数可以随时间跟踪。

#### 验收标准

1. 当扫描新 Agent 时，数据层应在 Supabase 中创建或更新 Agent 记录
2. 当存储 Agent 数据时，数据层应持久化 SR 分数、轨道类型、各项指标分数和扫描时间戳
3. 当 Agent 被认领时，数据层应将 is_claimed 字段更新为 true
4. 当存储扫描结果时，数据层应维护分数历史用于趋势跟踪
5. 当查询 Agent 时，数据层应支持按已验证状态过滤和按 SR 分数排序

### 需求 10: 系统性能与安全

**用户故事:** 作为平台运营者，我希望系统受到保护免受滥用，并优化成本效率，这样恶意行为者无法耗尽我们的资源。

#### 验收标准

1. 当匿名用户提交扫描请求时，速率限制器应强制执行每 IP 每小时 5 次扫描的限制
2. 当超过速率限制时，速率限制器应返回 429 状态码，带有 retry-after 头和用户友好的消息
3. 当收到扫描请求时，缓存层应在启动新扫描前检查是否存在不到 24 小时的现有扫描结果
4. 当存在缓存结果时，缓存层应返回缓存数据，并为想要新数据的用户提供"重新扫描"选项
5. 当调用 GitHub API 时，扫描器应实现指数退避以优雅处理速率限制响应
6. 当已认证用户扫描时，速率限制器应允许更高的限制，每小时 20 次扫描
