# Implementation Plan

- [x] 1. 设置项目基础设施和测试框架




  - 安装和配置Vitest测试框架
  - 安装和配置fast-check属性测试库
  - 创建测试配置文件 (vitest.config.ts)
  - 设置测试辅助文件 (test/setup.ts)
  - _需求: 9.1, 9.5_

- [-] 2. 创建基础UI组件库



  - [x] 2.1 实现基础按钮组件




    - 创建可复用的Button组件，支持多种样式变体
    - 实现hover和focus状态
    - 确保44x44像素最小触摸目标
    - _需求: 10.2_

  - [ ]* 2.2 编写Button组件的单元测试
    - 测试不同props下的渲染
    - 测试点击事件处理
    - 测试可访问性属性
    - _需求: 10.2_

  - [x] 2.3 实现基础卡片组件





    - 创建Card组件作为Agent卡片的基础
    - 实现阴影和hover效果
    - 支持响应式布局
    - _需求: 3.4_

  - [ ]* 2.4 编写Card组件的单元测试
    - 测试渲染和样式
    - 测试响应式行为
    - _需求: 3.4_

- [x] 3. 增强主页Hero Section



  - [x] 3.1 实现渐变背景和视觉效果



    - 创建多层渐变背景 (blue-600 → indigo-600 → purple-700)
    - 添加SVG图案叠加层
    - 实现动画效果
    - _需求: 1.1, 1.2_

  - [x] 3.2 添加价值主张和CTA按钮


    - 编写清晰的价值主张文案
    - 创建CTA按钮导航到Agent市场和发布页面
    - 实现响应式文字大小
    - _需求: 1.4_

  - [x] 3.3 实现响应式布局


    - 适配移动端 (< 768px)
    - 适配平板 (768-1024px)
    - 适配桌面端 (> 1024px)
    - _需求: 1.3, 10.1_

  - [ ]* 3.4 编写属性测试：响应式布局适配
    - **属性 2: 响应式布局适配**
    - **验证: 需求 1.3**
    - 测试不同视口宽度下的布局适配
    - _需求: 1.3_

  - [ ]* 3.5 编写属性测试：主页加载时间
    - **属性 1: 主页加载时间**
    - **验证: 需求 1.2**
    - 测试渐变背景和视觉效果在2秒内渲染
    - _需求: 1.2_

- [x] 4. 实现模式切换功能





  - [x] 4.1 创建ModeSwitcher组件


    - 实现Tab式导航UI
    - 使用useSearchParams和useRouter管理URL状态
    - 添加客户端组件标记 ('use client')
    - _需求: 2.1, 2.5_


  - [x] 4.2 实现客户端导航逻辑

    - 实现无页面重载的导航
    - 管理滚动位置
    - 添加活动状态高亮
    - _需求: 2.2, 2.3, 2.4_

  - [x] 4.3 编写属性测试：客户端导航




    - **属性 3: 客户端导航到Agent市场**
    - **属性 4: 客户端导航到发布Agent**
    - **验证: 需求 2.2, 2.3**
    - 测试URL更新不触发完整页面重载
    - _需求: 2.2, 2.3_

  - [x] 4.4 编写属性测试：滚动位置管理



    - **属性 5: 滚动位置管理**
    - **验证: 需求 2.4**
    - 测试模式切换时的滚动位置行为
    - _需求: 2.4_


  - [x] 4.5 编写属性测试：活动模式高亮


    - **属性 6: 活动模式高亮**
    - **验证: 需求 2.5**
    - 测试活动模式的视觉指示器
    - _需求: 2.5_

- [x] 5. 增强Agent卡片组件





  - [x] 5.1 重构AgentCard组件


    - 添加AI搜索统计显示
    - 改进hover效果
    - 实现响应式设计
    - _需求: 3.2, 3.4_


  - [x] 5.2 实现AI统计显示逻辑

    - 显示聚合搜索计数
    - 格式化大数字 (1,000 或 1K)
    - 添加视觉图标
    - _需求: 8.1, 8.5_

  - [ ]* 5.3 编写属性测试：Agent卡片完整性
    - **属性 8: Agent卡片完整性**
    - **验证: 需求 3.2**
    - 测试所有必需字段的存在
    - _需求: 3.2_

  - [ ]* 5.4 编写属性测试：聚合计数显示
    - **属性 27: 聚合计数显示**
    - **验证: 需求 8.1**
    - 测试显示的计数等于所有AI引擎计数之和
    - _需求: 8.1_

  - [ ]* 5.5 编写属性测试：数字格式化
    - **属性 31: 数字格式化**
    - **验证: 需求 8.5**
    - 测试大于999的数字使用适当分隔符
    - _需求: 8.5_

- [x] 6. 实现Agent市场网格




  - [x] 6.1 创建AgentMarketGrid组件


    - 实现网格布局
    - 添加排序功能 (popularity, recent, ai_search_count)
    - 实现分页或无限滚动
    - _需求: 3.1, 3.3_

  - [x] 6.2 实现加载状态


    - 创建骨架屏组件
    - 添加加载指示器
    - 实现平滑过渡
    - _需求: 3.5_


  - [x] 6.3 实现移动端单列布局

    - 在视口 < 768px 时显示单列
    - 优化触摸交互
    - _需求: 10.4_

  - [ ]* 6.4 编写属性测试：Agent排序
    - **属性 7: Agent排序**
    - **验证: 需求 3.1**
    - 测试按选定标准降序排列
    - _需求: 3.1_

  - [ ]* 6.5 编写属性测试：移动端网格布局
    - **属性 37: 移动端网格布局**
    - **验证: 需求 10.4**
    - 测试移动端单列显示
    - _需求: 10.4_

- [x] 7. 优化Agent详情页







  - [x] 7.1 增强SEO/GEO元数据



    - 实现generateMetadata函数
    - 添加完整的meta标签 (title, description, keywords)
    - 添加Open Graph标签
    - _需求: 4.4, 7.3_



  - [x] 7.2 添加JSON-LD结构化数据
    - 实现Schema.org SoftwareApplication schema
    - 包含所有必需字段
    - 验证JSON-LD格式
    - _需求: 4.3, 7.1_

  - [x] 7.3 实现语义化HTML和ARIA
    - 使用HTML5语义元素
    - 添加ARIA标签
    - 确保键盘导航
    - _需求: 7.2_

  - [x] 7.4 创建AISearchStats组件
    - 显示AI搜索统计细分
    - 实现简单条形图可视化
    - 显示百分比和趋势
    - _需求: 4.5, 8.2_

  - [x]* 7.5 编写属性测试：Agent详情完整性
    - **属性 10: Agent详情完整性**
    - **验证: 需求 4.2**
    - 测试所有必需信息字段的显示
    - _需求: 4.2_

  - [x]* 7.6 编写属性测试：结构化数据存在性
    - **属性 11: 结构化数据存在性**
    - **验证: 需求 4.3**
    - 测试JSON-LD结构化数据的有效性
    - _需求: 4.3_

  - [x]* 7.7 编写属性测试：SEO元标签完整性
    - **属性 12: SEO元标签完整性**
    - **验证: 需求 4.4**
    - 测试所有必需meta标签的存在
    - _需求: 4.4_

  - [x]* 7.8 编写属性测试：AI统计细分
    - **属性 13: AI统计细分**
    - **属性 28: 详细细分显示**
    - **验证: 需求 4.5, 8.2**
    - 测试每个AI引擎的计数细分显示
    - _需求: 4.5, 8.2_

  - [x]* 7.9 编写属性测试：语义化HTML和ARIA
    - **属性 24: 语义化HTML和ARIA**
    - **验证: 需求 7.2**
    - 测试语义化元素和ARIA标签
    - _需求: 7.2_

  - [x]* 7.10 编写属性测试：关键词派生
    - **属性 25: 关键词派生**
    - **验证: 需求 7.3**
    - 测试meta关键词从类别和特性派生
    - _需求: 7.3_

- [x] 8. 实现Agent导航




  - [x] 8.1 实现卡片点击导航


    - 添加Link组件到Agent卡片
    - 使用正确的slug路由
    - 实现focus状态
    - _需求: 4.1_



  - [ ] 8.2 编写属性测试：Agent导航

    - **属性 9: Agent导航**
    - **验证: 需求 4.1**
    - 测试点击导航到正确的详情页
    - _需求: 4.1_

- [x] 9. 实现AI机器人检测和统计




  - [x] 9.1 增强AI检测逻辑




    - 检测ChatGPT、Claude、Perplexity等机器人
    - 解析User-Agent和Referer
    - 实现准确的机器人识别
    - _需求: 8.3_



  - [x] 9.2 实现统计增量逻辑


    - 在机器人访问时增加计数器
    - 立即持久化到数据库
    - 更新ai_visits表
    - _需求: 8.3, 8.4_



  - [x]* 9.3 编写属性测试：机器人检测和增量

    - **属性 29: 机器人检测和增量**
    - **验证: 需求 8.3**
    - 测试机器人类型检测和计数器增加
    - _需求: 8.3_


  - [x]* 9.4 编写属性测试：立即持久化

    - **属性 30: 立即持久化**
    - **验证: 需求 8.4**
    - 测试更改在响应前持久化
    - _需求: 8.4_

- [x] 10. 创建URL分析服务


  - [x] 10.1 实现URL验证和清理


    - 创建validateURL函数
    - 验证URL格式
    - 清理和规范化URL
    - 只允许http/https协议
    - _需求: 5.2_

  - [x]* 10.2 编写属性测试：URL格式验证
    - **属性 14: URL格式验证**
    - **验证: 需求 5.2**
    - 测试有效URL接受和无效URL拒绝
    - _需求: 5.2_


  - [x] 10.3 实现网页抓取功能
    - 使用Playwright抓取页面
    - 处理超时和错误
    - 提取HTML内容
    - _需求: 6.1_

  - [ ]* 10.4 编写属性测试：网页抓取
    - **属性 18: 网页抓取**
    - **验证: 需求 6.1**
    - 测试成功抓取网页内容
    - _需求: 6.1_


  - [x] 10.5 实现HTML解析
    - 解析HTML结构
    - 提取title、meta、content
    - 清理和格式化文本
    - _需求: 6.2_

  - [x]* 10.6 编写属性测试：HTML解析
    - **属性 19: HTML解析**
    - **验证: 需求 6.2**
    - 测试HTML结构解析和文本提取
    - _需求: 6.2_

  - [x] 10.7 实现AI分析集成
    - 调用OpenRouter API (qwen模型)
    - 生成结构化Agent数据
    - 实现重试逻辑
    - _需求: 6.3_

  - [ ]* 10.8 编写属性测试：AI分析执行
    - **属性 20: AI分析执行**
    - **验证: 需求 6.3**

    - 测试AI分析生成描述和特性
    - _需求: 6.3_

  - [x] 10.9 实现数据验证

    - 使用Zod验证schema
    - 确保必需字段存在
    - 验证数据类型
    - _需求: 6.4_

  - [x]* 10.10 编写属性测试：Schema验证
    - **属性 21: Schema验证**
    - **验证: 需求 6.4**
    - 测试AI生成数据的schema验证
    - _需求: 6.4_

  - [x]* 10.11 编写属性测试：信息提取完整性
    - **属性 16: 信息提取完整性**
    - **验证: 需求 5.4**
    - 测试提取数据包含最少必需字段
    - _需求: 5.4_

- [x] 11. 创建发布Agent表单
  - [x] 11.1 实现PublishAgentForm组件
    - 创建表单UI
    - 添加URL输入字段
    - 添加可选的email和notes字段
    - 实现客户端验证
    - _需求: 5.1_

  - [x] 11.2 实现表单提交逻辑
    - 处理表单提交
    - 显示加载状态
    - 显示成功/错误消息
    - _需求: 5.2_

  - [x] 11.3 实现移动端优化
    - 使用适当的input类型 (url, email)
    - 优化触摸交互
    - 响应式布局
    - _需求: 10.3_

  - [x] 11.4 编写属性测试：移动端输入类型
    - **属性 36: 移动端输入类型**
    - **验证: 需求 10.3**
    - 测试表单输入类型设置正确
    - _需求: 10.3_

  - [x]* 11.5 编写属性测试：触摸目标尺寸
    - **属性 35: 触摸目标尺寸**
    - **验证: 需求 10.2**
    - 测试交互元素至少44x44像素
    - _需求: 10.2_

- [x] 12. 创建提交Agent API端点
  - [x] 12.1 实现/api/submit-agent路由
    - 创建POST端点
    - 验证请求数据
    - 实现速率限制
    - _需求: 5.2, 5.3_

  - [x] 12.2 集成URL分析服务
    - 调用analyzeURL函数
    - 处理分析结果
    - 处理错误情况
    - _需求: 5.3, 5.4_

  - [x] 12.3 实现数据库存储
    - 创建新Agent记录
    - 存储到Supabase
    - 返回Agent ID
    - _需求: 5.5, 6.5_

  - [x]* 12.4 编写属性测试：分析启动
    - **属性 15: 分析启动**
    - **验证: 需求 5.3**
    - 测试有效URL提交触发分析
    - _需求: 5.3_

  - [x]* 12.5 编写属性测试：数据库持久化
    - **属性 17: 提取后的数据库持久化**
    - **属性 22: 数据库存储**
    - **验证: 需求 5.5, 6.5**
    - 测试成功提取的信息创建数据库条目
    - _需求: 5.5, 6.5_

  - [x]* 12.6 编写集成测试：完整提交流程
    - 测试从URL提交到Agent创建的完整流程
    - 验证数据库中的记录
    - 测试错误处理
    - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 13. 实现性能优化




  - [x] 13.1 优化图片加载


    - 使用Next.js Image组件
    - 实现lazy loading
    - 添加blur placeholder
    - _需求: 9.2_

  - [ ]* 13.2 编写属性测试：Next.js Image使用
    - **属性 32: Next.js Image使用**
    - **验证: 需求 9.2**
    - 测试图片元素使用Next.js Image组件
    - _需求: 9.2_



  - [ ] 13.3 实现数据缓存
    - 配置ISR (revalidate: 3600)
    - 实现Supabase查询缓存
    - 添加缓存头
    - _需求: 9.3, 9.4_

  - [ ]* 13.4 编写属性测试：缓存实现
    - **属性 33: 缓存实现**
    - **验证: 需求 9.3**
    - 测试Supabase响应包含缓存头


    - _需求: 9.3_

  - [ ] 13.5 实现代码分割
    - 动态导入重型组件
    - 优化bundle大小
    - 实现路由级代码分割
    - _需求: 9.1_




  - [ ]* 13.6 编写属性测试：服务端渲染
    - **属性 26: 服务端渲染**


    - **验证: 需求 7.5**
    - 测试初始HTML包含完整页面内容
    - _需求: 7.5_



- [ ] 14. 实现错误处理


  - [x] 14.1 创建错误边界组件


    - 实现error.tsx
    - 实现not-found.tsx
    - 添加友好的错误消息
    - _需求: 所有_

  - [ ] 14.2 实现Toast通知系统
    - 创建Toast组件
    - 实现useToast hook
    - 添加成功/错误/警告样式
    - _需求: 所有_

  - [ ] 14.3 实现日志系统
    - 创建logger工具
    - 记录错误和警告
    - 集成错误监控（可选）
    - _需求: 所有_

  - [ ]* 14.4 编写单元测试：错误处理
    - 测试各种错误场景
    - 测试错误消息显示
    - 测试错误恢复
    - _需求: 所有_

- [-] 15. 实现安全措施


  - [x] 15.1 实现输入验证


    - 使用Zod schema验证
    - 清理用户输入
    - 防止XSS攻击
    - _需求: 5.2_

  - [x] 15.2 实现速率限制


    - 集成Upstash Redis
    - 限制API调用频率
    - 返回适当的错误消息
    - _需求: 9.5_

  - [-] 15.3 配置内容安全策略

    - 添加CSP头
    - 配置允许的来源
    - 测试CSP规则
    - _需求: 所有_

  - [ ]* 15.4 编写单元测试：安全验证
    - 测试输入验证
    - 测试URL清理
    - 测试速率限制
    - _需求: 5.2, 9.5_

- [ ] 16. 实现可访问性增强
  - [ ] 16.1 添加键盘导航支持
    - 实现Tab导航
    - 添加focus样式
    - 支持Enter/Space激活
    - _需求: 7.2_

  - [ ] 16.2 优化颜色对比度
    - 确保4.5:1对比度
    - 测试所有文本元素
    - 提供高对比度选项
    - _需求: 7.2_

  - [ ]* 16.3 运行可访问性审计
    - 使用axe-core测试
    - 修复发现的问题
    - 确保WCAG 2.1 AA合规
    - _需求: 7.2_

- [ ] 17. 第一次检查点 - 确保所有测试通过
  - 运行完整测试套件
  - 修复失败的测试
  - 确保代码覆盖率 ≥ 80%
  - 如有问题请询问用户

- [ ] 18. 移动端测试和优化
  - [ ] 18.1 测试移动端布局
    - 在不同设备尺寸测试
    - 验证触摸交互
    - 测试移动端导航
    - _需求: 10.1, 10.2, 10.4, 10.5_

  - [ ]* 18.2 编写属性测试：移动端布局优化
    - **属性 34: 移动端布局优化**
    - **验证: 需求 10.1**
    - 测试移动端优化布局渲染
    - _需求: 10.1_

  - [ ] 18.3 优化移动端性能
    - 减少移动端bundle大小
    - 优化图片尺寸
    - 测试移动网络条件
    - _需求: 9.1_

- [-] 19. SEO审计和优化


  - [x] 19.1 运行Lighthouse审计




    - 确保SEO分数 ≥ 90
    - 确保性能分数 ≥ 90
    - 确保可访问性分数 ≥ 90
    - _需求: 7.4, 9.1_

  - [ ] 19.2 生成和配置sitemap
    - 运行sitemap生成脚本
    - 配置robots.txt
    - 提交到搜索引擎
    - _需求: 7.5_

  - [ ]* 19.3 编写属性测试：JSON-LD结构化数据有效性
    - **属性 23: JSON-LD结构化数据有效性**
    - **验证: 需求 7.1**
    - 测试JSON-LD符合Schema.org规范
    - _需求: 7.1_

- [ ] 20. 最终测试和部署准备
  - [ ] 20.1 运行完整测试套件
    - 运行所有单元测试
    - 运行所有属性测试
    - 运行所有集成测试
    - 确保100%测试通过
    - _需求: 所有_

  - [ ] 20.2 性能测试
    - 测试首次内容绘制时间
    - 测试API响应时间
    - 测试数据库查询性能
    - _需求: 9.1, 9.5_

  - [ ] 20.3 配置环境变量
    - 验证所有必需的环境变量
    - 配置生产环境变量
    - 测试环境变量加载
    - _需求: 所有_

  - [ ] 20.4 部署前检查清单
    - [ ] 所有测试通过
    - [ ] 代码覆盖率 ≥ 80%
    - [ ] Lighthouse分数 ≥ 90
    - [ ] 移动端测试通过
    - [ ] 可访问性测试通过
    - [ ] 环境变量配置正确
    - [ ] Sitemap已生成
    - [ ] robots.txt已配置
    - _需求: 所有_

- [ ] 21. 部署到Vercel
  - 运行生产构建
  - 部署到Vercel
  - 验证生产环境
  - 监控错误和性能
  - _需求: 所有_
